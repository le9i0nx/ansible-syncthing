# Dockerfile for building Ansible image for Debian 8 (jessie), with as few additional software as possible.

FROM debian:jessie
ENV LC_ALL C
ENV DEBIAN_FRONTEND noninteractive

MAINTAINER Aleksej Gavrilov <le9i0nx@gmail.com>


RUN apt-get update  && \
    apt-get dist-upgrade -y && \
    apt-get install -y \
        sudo openssh-server && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*  /tmp/*

RUN systemctl mask \
    systemd-remount-fs.service \
    dev-hugepages.mount \
    sys-fs-fuse-connections.mount \
    systemd-logind.service \
    getty.target \
    console-getty.service \
    dev-mqueue.mount \
    sys-kernel-config.mount \
    sys-kernel-debug.mount \
    display-manager.service \
    graphical.target

RUN sed -ri 's/^PermitRootLogin\s+.*/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN echo "root:000000" | chpasswd

VOLUME ["/sys/fs/cgroup"]
VOLUME ["/run"]
VOLUME ["/tmp"]
ENV container=docker
ENV init /lib/systemd/systemd
ENTRYPOINT ["/lib/systemd/systemd"]
# docker run -d --privileged -it -v /sys/fs/cgroup:/sys/fs/cgroup:ro test-debian8

